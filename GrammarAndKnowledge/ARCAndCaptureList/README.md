# ARCì™€ ìº¡ì³ë¦¬ìŠ¤íŠ¸

[ì• í”Œ ê³µì‹ ë¬¸ì„œ](https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html) ê¸°ë°˜ ê³µë¶€ í›„ ì •ë¦¬

## ğŸ ARC
- ARCëŠ” Swiftì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë°©ë²•
    - classì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ARCëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•œë‹¤.
    - ì´ì—ëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ íƒ€ì…, ì €ì¥ í”„ë¡œí¼í‹°ì˜ ê°’ì´ ë‹´ê¸´ë‹¤. 
    - ì¸ìŠ¤í„´ìŠ¤ê°€ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ ARCëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ ì¡ê³ ìˆë˜ ë©”ëª¨ë¦¬ë¥¼ í•´ì œì‹œì¼œ ë‹¤ë¥¸ ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
    - ì‚¬ìš©ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ë©”ëª¨ë¦¬ë¥¼ í•´ì œì‹œí‚¤ë©´ ì¸ìŠ¤í„´ìŠ¤ì˜ í”„ë¡œí¼í‹°ë“¤ê³¼ ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œë¥¼ ë”ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ì—†ê³  ë§Œì•½ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•œë‹¤ë©´ ì•±ì€ í¬ë˜ì‹œë‚œë‹¤.
    - ì¸ìŠ¤í„´ìŠ¤ê°€ ì‚¬ìš©ì¤‘ ì¼ë•Œ í•´ì œ ë˜ëŠ”ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´, ARCëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” í”„ë¡œí¼í‹°, ìƒìˆ˜, ë³€ìˆ˜ë¥¼ ì¹´ìš´íŠ¸í•œë‹¤.
    - ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì´ˆí•˜ëŠ” ì¹´ìš´íŠ¸ê°€ í•˜ë‚˜ë¼ë„ ìˆë‹¤ë©´ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œí•˜ì§€ ì•ŠëŠ”ë‹¤.

## ğŸ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ì´ ê°•í•œ ì°¸ì¡° ìˆœí™˜
- ë‘ ê°œì˜ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ì„œë¡œë¥¼ ì°¸ì¡° í•˜ê³  ìˆì–´ì„œ ì„œë¡œê°€ ì„œë¡œë¥¼ ìœ ì§€í•˜ëŠ” ìƒí™©.

```swift
class Person {
    let name: String
    init(name: String) { self.name = name }
    var apartment: Apartment?
    deinit { print("\(name) is being deinitialized") }
}

class Apartment {
    let unit: String
    init(unit: String) { self.unit = unit }
    var tenant: Person?
    deinit { print("Apartment \(unit) is being deinitialized") }
}
```

- Person ê°ì²´ëŠ” name(String), apartment(Apartment?) í”„ë¡œí¼í‹°ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
    - ëª¨ë“  ì‚¬ëŒì´ ì•„íŒŒíŠ¸ë¥¼ ê°€ì§€ê³  ìˆëŠ”ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì˜µì…”ë„
- Apartment ê°ì²´ ë˜í•œ unit(String), tenant(Person?) í”„ë¡œí¼í‹°ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
    - ëª¨ë“  ì•„íŒŒíŠ¸ì— ê±°ì£¼ìê°€ ìˆëŠ”ê²ƒì€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì˜µì…”ë„
- ë‘ í´ë˜ìŠ¤ ëª¨ë‘ ì†Œë©¸ìê°€ êµ¬í˜„ë˜ì–´ìˆì–´ ê°ì²´ë¥¼ ì†Œë©¸ ì‹œí‚¬ë•Œ ì˜ˆìƒëŒ€ë¡œ ì†Œë©¸ í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.

```swift
var john: Person?
var unit4A: Apartment?
```
- í˜„ì¬ëŠ” ë‘ ê°ì²´ ëª¨ë‘ nil ìƒíƒœ

```swift
john = Person(name: "John Appleseed")
unit4A = Apartment(unit: "4A")
```
- johnì— Person ì¸ìŠ¤í„´ìŠ¤ë¥¼ í• ë‹¹
    - ì´ë•Œ Person ì¸ìŠ¤í„´ìŠ¤ì˜ RCëŠ” 1ì´ë‹¤. ì™œ?
    - ë³€ìˆ˜ johnì´ Person ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°•í•œ ì°¸ì¡°í•˜ê³  ìˆê¸° ë•Œë¬¸ì—.
- unit4Aì— Apartment ì¸ìŠ¤í„´ìŠ¤ë¥¼ í• ë‹¹
    - ì´ë•Œ Apartment ì¸ìŠ¤í„´ìŠ¤ì˜ RCëŠ” 1ì´ë‹¤. ì™œ?
    - ë³€ìˆ˜ unit4Aê°€ Apartment ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°•í•œ ì°¸ì¡°í•˜ê³  ìˆê¸° ë•Œë¬¸ì—.
- **ìœ„ì—ì„œ ì´ì•¼ê¸° í•œ ê²ƒ ì²˜ëŸ¼,**
    - **ì¸ìŠ¤í„´ìŠ¤ê°€ ì‚¬ìš©ì¤‘ ì¼ë•Œ í•´ì œ ë˜ëŠ”ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´, ARCëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” í”„ë¡œí¼í‹°, ìƒìˆ˜, ë³€ìˆ˜ë¥¼ ì¹´ìš´íŠ¸í•œë‹¤.**
- ì´ ê³¼ì •ì„ ë§ˆì¹˜ê³  ë‚˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê·¸ë¦¼ì„ ê°€ì§€ê³  ìˆì„ê²ƒì´ë‹¤.

![](https://i.imgur.com/iTzMibo.png)


- ìœ„ì˜ ì‚¬ì§„ì„ ë³´ê³  ì•„ë˜ì™€ ê°™ì´ ì´ì•¼ê¸° í•  ìˆ˜ ìˆë‹¤.
    - johnì´ë¼ëŠ” ë³€ìˆ˜ëŠ” ìƒˆë¡œ ìƒì„±ëœ Person ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ê°•í•œ ì°¸ì¡°ë¥¼ í•˜ê³ ìˆë‹¤.
    - unit4Aë¼ëŠ” ë³€ìˆ˜ëŠ” ìƒˆë¡œ ìƒì„±ëœ Apartmentì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ê°•í•œ ì°¸ì¡°ë¥¼ í•˜ê³ ìˆë‹¤.

```swift
john!.apartment = unit4A
unit4A!.tenant = john
```
- johnì—ê²Œ unit4Aë¼ëŠ” ì•„íŒŒíŠ¸ë¥¼, ì•„íŒŒíŠ¸ì—ê²ŒëŠ” johnì´ë¼ëŠ” ê±°ì£¼ìë¥¼ í• ë‹¹(ì—°ê²°)í•œë‹¤.
- ì´ ê³¼ì •ì„ ë§ˆì¹˜ê³  ë‚˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê·¸ë¦¼ì„ ê°€ì§€ê³  ìˆì„ê²ƒì´ë‹¤.

![](https://i.imgur.com/iNEsFJy.png)


- í˜„ì¬ ìƒí™©ì´ ê°•í•œ ì°¸ì¡° ìˆœí™˜ì´ë‹¤.
    - Person ì¸ìŠ¤í„´ìŠ¤ëŠ” Apartment ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ê°•í•œ ì°¸ì¡°ë¥¼ ê°€ì§€ê³ ìˆê³ , Apartment ì¸ìŠ¤í„´ìŠ¤ëŠ” Person ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ê°•í•œ ì°¸ì¡°ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ johnë³€ìˆ˜ì™€ unit4Aê°€ ê°€ì§€ê³  ìˆëŠ” ê°•í•œ ì°¸ì¡°ë¥¼ ëŠì–´ ë‚´ë”ë¼ë„, RCëŠ” 0ìœ¼ë¡œ ë–¨ì–´ì§€ì§€ ì•Šê³ , ì¸ìŠ¤í„´ìŠ¤ëŠ” ARCì— ì˜í•´ í•´ì œë˜ì§€ ì•ŠëŠ”ë‹¤.

```swift=
john = nil
unit4A = nil
```
- ìœ„ì˜ ì½”ë“œì²˜ëŸ¼ ë‘ ë³€ìˆ˜(johnê³¼ unit4A)ì— nilì„ ëŒ€ì… í•˜ë”ë¼ë„ ì•„ë˜ì™€ ê°™ì€ ê·¸ë¦¼ì²˜ëŸ¼ ë‘ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ì´ì˜ ê°•í•œ ìˆœí™˜ ì°¸ì¡°ê°€ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œë˜ëŠ”ê²ƒì„ ë§‰ê³ ìˆê³ , ì´ê²ƒì€ ë©”ëª¨ë¦¬ ë¦­ ìœ¼ë¡œ ì´ì–´ì§„ë‹¤.

![](https://i.imgur.com/idbZdpx.png)


## ğŸ ì•½í•œ ì°¸ì¡° / ë¯¸ì†Œìœ  ì°¸ì¡°ë¥¼ ì´ìš©í•œ ê°•í•œ ìˆœí™˜ ì°¸ì¡° ë¬¸ì œ í•´ê²°
- weak reference ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?
    - ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ë¼ì´í”„íƒ€ì„ì´ ë” ì§§ì„ ë•Œ ì‚¬ìš©.
- unowned reference ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?
    - ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ë¼ì´í”„íƒ€ì„ì´ ê°™ê±°ë‚˜ ë” ê¸¸ë•Œ ì‚¬ìš©.

### ğŸ“– weak reference (ì•½í•œ ì°¸ì¡°)
- ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ì•½í•œ ì°¸ì¡°ë¥¼ í•˜ê³ ìˆëŠ” ê²½ìš°ì—ë„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œì‹œí‚¬ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì°¸ì¡°í•˜ê³  ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œëœë‹¤ë©´ ARCê°€ nilë¡œ ì„¸íŒ….
- **weak referenceê°€ runtimeì— nilë¡œ ë³€ê²½ ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë³€ìˆ˜ + ì˜µì…”ë„ë¡œ ì„ ì–¸í•œë‹¤.**
- ARCê°€ weak referenceë¥¼ nilë¡œ ë³€ê²½í•´ë„ í”„ë¡œí¼í‹° ì˜µì ¸ë²„ëŠ” í˜¸ì¶œ ë˜ì§€ ì•ŠëŠ”ë‹¤.
- **ì•½í•œ ì°¸ì¡°ë¥¼ ì ìš©í•´ ê°•í•œ ì°¸ì¡° ìˆœí™˜ ë¬¸ì œ í•´ê²°í•˜ê¸°**
    - ì‚¬ëŒì€ ì•„íŒŒíŠ¸ë¥¼ ê°€ì§€ê³  ìˆì„ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ê¼­ í•´ë‹¹ ì•„íŒŒíŠ¸ì— ì‚´ í•„ìš”ëŠ” ì—†ìœ¼ë¯€ë¡œ Apartmentì˜ tenant í”„ë¡œí¼í‹°ì˜ ë¼ì´í”„ ì‚¬ì´í´ì´ ë” ì§§ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
```swift
class Person {
    let name: String
    init(name: String) { self.name = name }
    var apartment: Apartment?
    deinit { print("\(name) is being deinitialized") }
}

class Apartment {
    let unit: String
    init(unit: String) { self.unit = unit }
    weak var tenant: Person?
    deinit { print("Apartment \(unit) is being deinitialized") }
}
```
- ì•„ë˜ì˜ ì½”ë“œëŠ” ì´ì „ì²˜ëŸ¼ ë‘ ë³€ìˆ˜ë¥¼ ê°ê°ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ë„ë¡ í•˜ê³ , ì¸ìŠ¤í„´ìŠ¤ë¼ë¦¬ ì°¸ì¡°í•˜ë„ë¡ êµ¬í˜„.
```swift
var john: Person?
var unit4A: Apartment?

john = Person(name: "John Appleseed")
unit4A = Apartment(unit: "4A")

john!.apartment = unit4A
unit4A!.tenant = john
```
- ì•„ë˜ëŠ” ì´ ê³¼ì •ì„ ê±°ì¹˜ê³  ë‚œ í›„ ìƒíƒœë¥¼ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„
![](https://i.imgur.com/CFqwJEe.png)

- Person ì¸ìŠ¤í„´ìŠ¤ëŠ” ì•„ì§ë„ Apartment ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ê°•í•œ ì°¸ì¡°ë¥¼ í•˜ê³  ìˆì§€ë§Œ, Apartment ì¸ìŠ¤í„´ìŠ¤ëŠ” Person ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ì•½í•œ ì°¸ì¡°ë¥¼ í•˜ê³ ìˆë‹¤. ì´ ëœ»ì€ Person ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°•í•œ ì°¸ì¡°í•˜ê³  ìˆëŠ” john ë³€ìˆ˜ë¥¼ nilë¡œ ì…‹íŒ…í–ˆì„ë•Œ, Person ì¸ìŠ¤í„´ìŠ¤ì˜ Reference Countê°€ 0ì´ ë¨ì— ë”°ë¼ ì•„ë˜ì™€ ê°™ì´ Person ì¸ìŠ¤í„´ìŠ¤ê°€ ë©”ëª¨ë¦¬ì—ì„œ í•´ì œëœë‹¤.

```swift
john = nil // Prints "John Appleseed is being deinitialized"
```
- johnì´ ë”ì´ìƒ Person ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ.

![](https://i.imgur.com/jrhcGYe.png)

```swift
unit4A = nil // Prints "Apartment 4A is being deinitialized"
```
- unit4A ë³€ìˆ˜ê°€ ë”ì´ìƒ Apartment ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠìŒ.

![](https://i.imgur.com/d02GSq4.png)


### ğŸ“– unowned reference (ë¯¸ì†Œìœ  ì°¸ì¡°)
- ì•½í•œ ì°¸ì¡°(weak reference)ì™€ ë‹¤ë¥´ê²Œ ë¯¸ì†Œìœ  ì°¸ì¡°(unowned reference)ëŠ” ì°¸ì¡°í•˜ê³  ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ë³´ë‹¤ ë” ê¸´ ë¼ì´í”„ì‚¬ì´í´ì„ ê°€ì§ˆë•Œ ì‚¬ìš©. -> ì•„ë˜ì˜ ì½”ë“œë¥¼ ë³´ê³  ì´í•´í•´ë³´ì.

```swift
class Customer {
    let name: String
    var card: CreditCard?
    init(name: String) {
        self.name = name
    }
    deinit { print("\(name) is being deinitialized") }
}

class CreditCard {
    let number: UInt64
    unowned let customer: Customer
    init(number: UInt64, customer: Customer) {
        self.number = number
        self.customer = customer
    }
    deinit { print("Card #\(number) is being deinitialized") }
}
```

## ğŸ ì ê¹ ì •ë¦¬!
- Personê³¼ Apartment ì½”ë“œì—ì„œ ì™œ Apartmentì˜ tenant í”„ë¡œí¼í‹°ê°€ weak varë¡œ ì„ ì–¸ë˜ì—ˆì§€?
    - ê·¹ë‹¨ì ì¸ ì˜ˆë¡œ Person ì¸ìŠ¤í„´ìŠ¤ëŠ” ì•„íŒŒíŠ¸ë¥¼ ê°€ì§€ê³  ìˆì„ ìˆ˜ ìˆì§€ë§Œ ê¼­ ê·¸ ì•„íŒŒíŠ¸ì— ì‚´ í•„ìš”ëŠ” ì—†ë‹¤.
    - ì¦‰, tenantê°€ nilì´ ë  í™•ë¥ ì´ ë” ë†’ë‹¤ëŠ” ì´ì•¼ê¸°.
    - apartmentì™€ tenant ë‘˜ì¤‘ ì–´ë–¤ê²ƒì—ë„ weakë¥¼ ë¶™ì—¬ë„ ì½”ë“œëŠ” ë¬¸ì œì—†ì´ ëŒì•„ê°€ì§€ë§Œ ì„¤ì •ìƒ ë¼ì´í”„ ì‚¬ì´í´ì´ ì§§ì€ê²ƒì— ë¶™ì„.
- Customerê³¼ CreditCard ì½”ë“œì—ì„œ ì™œ CreditCard classì˜ customer í´ë˜ìŠ¤ê°€ unownedì¼ê¹Œ?
    - unowned í‚¤ì›Œë“œëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ ë¼ì´í”„ ì‚¬ì´í´ì´ ê°™ê±°ë‚˜ ë” ê¸´ìª½ì— ë¶™ì¸ë‹¤.
    - ê³ ê°ì€ ì‹ ìš©ì¹´ë“œë¥¼ ê°€ì§€ê³  ìˆì„ìˆ˜ë„ ìˆê³  ì•„ë‹ìˆ˜ë„ ìˆì§€ë§Œ, ì‹ ìš©ì¹´ë“œëŠ” í•­ìƒ ì£¼ì¸(ê³ ê°)ì´ í•„ìš”í•˜ë‹¤.
    - ì¦‰ Customerì˜ ë¼ì´í”„ ì‚¬ì´í´ì´ ë” ê¸¸ê¸° ë•Œë¬¸ì— customer í”„ë¡œí¼í‹°ì— ë¶™ì—¬ ê°•í•œ ì°¸ì¡° ìˆœí™˜ ë¬¸ì œ í•´ê²°.



## ğŸ í´ë¡œì ¸ì—ì„œ ê°’ì„ ìº¡ì³í•˜ê¸°

## ğŸ Citation
[ì• í”Œ ê³µì‹ ë¬¸ì„œ](https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html)

